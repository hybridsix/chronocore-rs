<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>CCRS — Entrants & Tags</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- CSS order mirrors index.html -->
  <link rel="stylesheet" href="../css/base.css" />
  <link rel="stylesheet" href="../css/operator.css" />
  <link rel="stylesheet" href="../css/entrants.css" />

  <!-- JS: helpers first, then page logic; both deferred -->
  <script src="../js/base.js" defer></script>
  <script src="../js/entrants.js" defer></script>
</head>

<body class="entrants">

  <!-- HEADER: brand + page label on the left; DB pill on the right -->
  <header class="app-header">
    <div class="brand">
      <img class="brand-logo" src="../img/CCRS_Logo.svg" alt="ChronoCore Logo">
      <div class="brand__wordmark" aria-label="ChronoCore Race Software">
        <div class="wordmark__top">
          <span class="wordmark__big">CHRONO</span>
          <span class="wordmark__big">CORE</span>
        </div>
        <div class="wordmark__bottom">RACE SOFTWARE</div>
      </div>
      <!-- NEW: page label beside brand (red squiggle) -->
      <div class="page-label">Entrants &amp; Tags</div>
    </div>

    <div class="app-header__tools">
      <div class="pill" id="readyPill" aria-live="polite">DB: checking…</div>
    </div>
  </header>

  <main class="wrap">
    <!-- Removed the old <h1 class="page-title"> ... (title now in header) -->

    <!-- DB not ready warning -->
    <div id="readyWarn" class="flag hidden" role="status" aria-live="polite">
      <div class="flag__label">Database isn’t ready yet. You can browse, but saving is disabled.</div>
    </div>

    <section class="ent-grid">
    <!-- LEFT PANE (drawer + scanner) -->
    <div class="pane pane--left">
      <div class="pane__scroll">
        <div class="drawer card">
          <h2>Entrant</h2>

          <!-- Tag + Scan/Stop/Assign in one row -->
          <div class="field">
            <label class="label" for="entTag">Tag</label>

            <div class="tag-row">
              <input
                id="entTag"
                name="tag"
                class="input input-sm"
                type="text"
                inputmode="numeric"
                autocomplete="off"
                placeholder="7+ digits (I-Lap)"
              />

              <div class="tag-actions">
                <button type="button" id="scanBtn"   class="btn btn-sm">Scan</button>
                <button type="button" id="stopBtn"   class="btn btn-sm" disabled>Stop</button>
                <button type="button" id="assignBtn" class="btn btn-sm" disabled>Assign</button>
              </div>
            </div>

            <!-- Slim progress bar appears only while scanning -->
            <div class="scan-progress" aria-hidden="true">
              <div id="scanBar"></div>
            </div>

            <!-- Small status line for scan feedback -->
            <div id="scanMsg" class="small muted" aria-live="polite"></div>

            <div class="hint small">Digits only. Scanning fills this field.</div>
          </div>


          <form id="entForm" novalidate>
            <input type="hidden" id="entId" />

            <div class="field">
              <label class="label" for="entNumber">Number</label>
              <input id="entNumber" name="number" class="input" type="text" inputmode="numeric" autocomplete="off" placeholder="e.g., 42" required>
              <div class="hint small">Positive integer.</div>
            </div>

            <div class="field">
              <label class="label" for="entName">Team</label>
              <input id="entName" name="name" class="input" type="text" autocomplete="off" placeholder="Team name" required>
              <div class="hint small">2–40 characters recommended.</div>
            </div>

            <div class="field">
              <label class="label" for="entTag">Tag (optional)</label>
              <input id="entTag" name="tag" class="input" type="text" inputmode="numeric" autocomplete="off" placeholder="7+ digits (I-Lap)">
              <div class="hint small">Digits only, or leave blank to clear.</div>
            </div>

            <div class="field inline">
              <input id="entEnabled" class="checkbox" type="checkbox" checked>
              <label for="entEnabled">Enabled</label>
            </div>

            <div class="buttons">
              <button type="button" id="saveBtn" class="btn btn-primary">Save (Enter)</button>
              <button type="button" id="resetBtn" class="btn">Reset (Esc)</button>
              <button type="button" id="newBtn" class="btn btn-ghost">New</button>
            </div>

            <div id="formMsg" class="form-msg" aria-live="polite"></div>
          </form>

          <hr class="section-sep" aria-hidden="true">
          <div class="bulk">
            <button type="button" id="importBtn" class="btn btn-chip" title="Phase 2 (stub)">Bulk Import (CSV/XLSX)</button>
            <div id="importNote" class="small muted">Import modal is a stub for now — UI only.</div>
          </div>
        </div>
      </div>
    </div>

    <!-- RIGHT PANE (table) -->
    <div class="pane pane--right">
      <div class="pane__scroll">
        <div class="ent-table-card card">
          <div class="table-header">
            <div class="filters">
              <input id="q" class="input input-sm" type="search" placeholder="Filter tag / number / team">
              <div class="chip-group" role="group" aria-label="Enabled filter">
                <button class="btn-ghost btn-chip active" data-filter="all">All</button>
                <button class="btn-ghost btn-chip" data-filter="enabled">Enabled</button>
                <button class="btn-ghost btn-chip" data-filter="disabled">Disabled</button>
              </div>
            </div>
            <div class="tools">
              <button id="refreshBtn" class="btn btn-sm">Refresh</button>
            </div>
          </div>

          <div class="table">
            <div class="ent-thead">
              <div class="th clickable" data-sort="enabled">Enabled</div>
              <div class="th clickable" data-sort="tag">Tag</div>
              <div class="th clickable right" data-sort="number">Number</div>
              <div class="th clickable" data-sort="name">Team</div>
              <div class="th">Actions</div>
              <div class="th right">Status</div>
            </div>
            <div id="rows" class="rows scroll" role="table" aria-label="Entrants table"></div>
          </div>
        </div>
      </div>
    </div>
  </section>

  </main>

  <footer class="app-footer">
    <div class="footer-left">
      <div class="status-dot" id="netDot"></div>
      <div id="netMsg">Ready</div>
    </div>
    <div class="footer-right">
      <a class="link" href="/admin/entrants" target="_blank" rel="noopener">GET /admin/entrants</a>
    </div>
  </footer>

  <!-- Quick Create -->
  <dialog id="quickCreateModal">
    <form id="quickForm" method="dialog" class="modal">
      <h3>New Entrant from Tag</h3>
      <p class="small muted">This tag isn’t assigned. Create an entrant now.</p>

      <div class="field">
        <label class="label" for="qcTag">Tag</label>
        <input id="qcTag" class="input" type="text" inputmode="numeric" autocomplete="off" readonly>
      </div>
      <div class="field">
        <label class="label" for="qcNumber">Number</label>
        <input id="qcNumber" class="input" type="text" inputmode="numeric" autocomplete="off" placeholder="e.g., 42" required>
      </div>
      <div class="field">
        <label class="label" for="qcName">Team</label>
        <input id="qcName" class="input" type="text" autocomplete="off" placeholder='e.g., "Unknown 1234567"' required>
      </div>
      <div class="field inline">
        <input id="qcEnabled" class="checkbox" type="checkbox" checked>
        <label for="qcEnabled">Enabled</label>
      </div>

      <div style="display:flex; gap:8px; justify-content:flex-end; margin-top:12px;">
        <button id="qcCancel" value="cancel" class="btn">Cancel</button>
        <button id="qcCreate" value="default" class="btn btn-primary">Create (Enter)</button>
      </div>
      <div id="qcMsg" class="form-msg" aria-live="polite"></div>
    </form>
  </dialog>

</body>
</html>
