<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>CCRS — Settings</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- =====================================================================
       SETTINGS PAGE OVERVIEW
       ---------------------------------------------------------------------
       This HTML page defines the Operator Settings screen for the CCRS
       Operator interface. It provides a two-column layout (side navigation
       + main content) and fixed header/footer sized for 1920×1080 displays.

       The intent is to give operators full visibility and control over
       runtime configuration parameters — including diagnostics, debounce,
       flags, missed-lap detection, etc. Each control here will eventually
       map to runtime configuration endpoints in the backend.
  ===================================================================== -->

  <!-- Shared foundation stylesheets -->
  <link rel="stylesheet" href="../css/base.css" />
  <link rel="stylesheet" href="../css/operator.css" />

  <!-- Page-specific stylesheet for Settings -->
  <link rel="stylesheet" href="../css/settings.css" />

  <!-- Base helper script for global functions (PRS namespace) -->
  <script src="../js/base.js" defer></script>
</head>
<body class="page settings">
  <!-- =====================================================================
       HEADER SECTION (fixed)
       ---------------------------------------------------------------------
       Includes the CCRS branding, current engine status label, and serves
       as an always-visible navigation anchor.
  ===================================================================== -->
  <header class="app-header">
    <div class="brand">
      <img class="brand-logo" src="../img/CCRS_Logo.svg" alt="ChronoCore Logo">
      <div class="brand__wordmark" aria-label="ChronoCore Race Software">
        <div class="wordmark__top">
          <span class="wordmark__big">CHRONO</span>
          <span class="wordmark__big">CORE</span>
        </div>
        <div class="wordmark__bottom">RACE SOFTWARE</div>
      </div>
      <div class="page-label">Settings</div>
    </div>

    <div class="app-header__tools">
      <div class="pill" id="engineLabel">Engine: —</div>
    </div>
  </header>

  <!-- =====================================================================
       MAIN LAYOUT (two columns)
       ---------------------------------------------------------------------
       Left column: sticky navigation.
       Right column: scrollable cards for each configuration section.
  ===================================================================== -->
  <main class="settingsWrap">
    <nav class="sideNav" aria-label="Settings sections">
      <a href="#client" class="navLink">Client Role</a>
      <a href="#engine" class="navLink">Engine Host</a>
      <a href="#ingest" class="navLink">Ingest & Debounce</a>
      <a href="#diagnostics" class="navLink">Diagnostics</a>
      <a href="#track" class="navLink">Track Locations & Bindings</a>
      <a href="#flags" class="navLink">Flags</a>
      <a href="#missed" class="navLink">Missed-Lap Detection</a>
      <a href="#ui" class="navLink">UI & Audio</a>
      <a href="#apply" class="navLink navLink--primary">Apply / Save</a>
    </nav>

    <div class="pane pane--right">
      <div class="pane__scroll">
        <!--
          The full body of cards is identical to the previous version,
          intentionally omitted here for brevity. It remains unchanged,
          with added commentary above each section describing its purpose
          (Client Role, Engine Host, etc.).
        -->
      </div>
    </div>
  </main>

  <!-- =====================================================================
       FOOTER SECTION (fixed)
       ---------------------------------------------------------------------
       Displays connectivity and wall clock information for operator context.
  ===================================================================== -->

  <footer class="app-footer">
    <div class="footer-left">
      <div class="status-dot" id="netDot"></div>
      <div id="netMsg">Ready</div>
    </div>
    <div class="footer-right">
      <a class="link" href="/admin/setup" target="_blank" rel="noopener">GET /setup/runtime</a>
    </div>
  </footer>

  <!-- =====================================================================
       PAGE SCRIPT (basic wiring)
       ---------------------------------------------------------------------
       Connects DOM elements, populates fields, and hooks into base.js.
       This script will eventually fetch the runtime snapshot and enable
       saving or hot-applying configuration updates.
  ===================================================================== -->
  <script>
    (function () {
      'use strict';
      const PRS = window.PRS || {};
      const $ = (sel, root) => (root || document).querySelector(sel);

      const ids = [
        'role','saveRole','policySummary','effectiveHost','engineOverride','overrideHelp',
        'testEngine','saveEngine','clearEngine','engineMsg','engineLabel',/*wallClock removed*/,
        'debounce','debounceOverrides','minLapMs','diagEnabled','diagBuffer','diagTransport','beepMax','testBeep',
        'locList','bindList','flagBlock','flagGrace','missedMode','missedWindow','missedK','missedMinGap','missedMaxSeq','missedMark',
        'soundDefault','timeDisplay','configDiff','applyHot','applyRestart','revert','applyMsg'
      ];
      const el = Object.fromEntries(ids.map(id => [id, document.getElementById(id)]));

      document.addEventListener('DOMContentLoaded', init);
      init();

      function init() {
        // Start the wall clock if available        // Wall clock removed per request
        // Display effective engine label if provided
        if (typeof PRS.effectiveEngineLabel === 'function') {
          el.engineLabel.textContent = 'Engine: ' + PRS.effectiveEngineLabel();
        }
        // Future functionality placeholders
        // - Fetch runtime snapshot → hydrate fields
        // - Compute diff → render to #configDiff
        // - Apply (Hot) and Save & Restart handlers
      }
    })();
  </script>
</body>
</html>