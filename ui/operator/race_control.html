<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>CCRS — Race Control</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Common operator CSS -->
  <link rel="stylesheet" href="/ui/css/base.css" />
  <link rel="stylesheet" href="/ui/css/operator.css" />
  <!-- Page-specific CSS -->
  <link rel="stylesheet" href="/ui/css/race_control.css" />
</head>

<body class="race-control">
  <!-- ==============================================================
       HEADER — standardized (same shell as other operator pages)
  ============================================================== -->
  <header class="app-header">
    <div class="brand">
  <a class="brand-link" href="/ui/operator/index.html">
        <img class="brand-logo" src="../img/CCRS_Logo.svg" alt="CCRS Logo" />
  <div class="brand__wordmark">
          <div class="wordmark__top">
            <span class="wordmark__big">CHRONO</span>
            <span class="wordmark__big">CORE</span>
          </div>
          <div class="wordmark__bottom">RACE SOFTWARE</div>
        </div>
      </a>
      <div class="page-label">Race Control</div>
    </div>

    <div class="app-header__tools">
      <nav class="app-nav">
        <a class="app-nav__link" href="/ui/operator/index.html" title="Home">
          <svg class="icon"><use href="../img/icons.svg#home"></use></svg>
          <span class="sr-only">Home</span>
        </a>

        <div class="app-nav__menu" id="appsMenu" data-open="false">
          <button type="button" class="app-nav__btn" title="Menu">
            <svg class="icon"><use href="../img/icons.svg#menu"></use></svg>
            <span class="sr-only">Open menu</span>
          </button>
          <div class="app-nav__panel" id="appsPanel">
            <a href="/ui/operator/entrants.html">Entrants &amp; Tags</a>
            <a href="/ui/operator/operator.html">Operator</a>
            <a href="/ui/operator/settings.html">Settings</a>
            <a href="/ui/operator/diag.html">Diagnostics</a>
            <a class="current" href="/ui/operator/race_control.html">Race Control</a>
            <a href="/ui/operator/help.html">Help</a>
          </div>
        </div>
      </nav>
    </div>
  </header>

  <!-- ==============================================================
       MAIN CONTENT
       Toolbar → two-column grid:
       - Left column: Flags (spans both rows)
       - Right column: Race clock (top) and Race data (bottom)
  ============================================================== -->
  <main class="rcWrap">
    <!-- Top toolbar -->
    <div class="toolBar">
      <div class="left">
        <!--<div class="toolTitle">Start settings</div>

         
        <label class="radio">
          <input type="radio" name="startMethod" id="startStanding" value="standing" checked>
          <span>Standing</span>
        </label>
        <label class="radio">
          <input type="radio" name="startMethod" id="startRolling" value="rolling">
          <span>Rolling</span>
        </label>
-->
        <div class="sep">|</div>

        <!-- Race summary -->
        <div class="toolbar-spacer"></div>
         <div class="rc-summary"><span id="rcSummaryText">—</span></div>

        
      
      </div>

        <div class="toolbar-center">
          <div id="flagPill">
            <span id="flagPillText">Pre-race</span>
          </div>
        </div>
    </div>

    <!-- Two-column grid -->
    <div class="rcGrid">
      <!-- Left: Flags (span both rows on the left) -->
  <section class="pane" id="paneFlags">
        <h2 class="pane__head" id="flagsTitle">Flags</h2>
        <div class="pane__body">
          <div id="flagColumn">
            <!-- Half-height pre-race button (same width as column) -->
            <div id="preFlagRow">
              <button class="flag flag--pre" data-flag="pre" type="button">Pre-race</button>
            </div>

            <!-- Uniform single-column flag pad -->
            <div class="flag-pad" id="flagPad">
              <button class="flag flag--green"     data-flag="green"     type="button">Green</button>
              <button class="flag flag--yellow"    data-flag="yellow"    type="button">Yellow</button>
              <button class="flag flag--red"       data-flag="red"       type="button">Red</button>
              <button class="flag flag--blue"      data-flag="blue"      type="button">Blue</button>
              <button class="flag flag--white"     data-flag="white"     type="button">White</button>
              <button class="flag flag--checkered" data-flag="checkered" type="button">Checkered</button>
            </div>
          </div>
        </div>
      </section>

      <!-- Right (row 1): Race clock -->
  <section class="pane" id="paneClock">
        <h2 class="pane__head" id="clockTitle">Race clock</h2>
        <div class="pane__body clockBody">
          <!-- NEW: actions live in the same row as the clock -->
          <div class="clockActions">
            <button id="btnStartRace"  class="btn btn-success">Start race</button>
            <button id="btnEndRace"    class="btn">End race</button>
            <button id="btnAbortReset" class="btn btn-danger">Abort &amp; reset</button>
          </div>
          <!-- Post-finish actions (hidden until CHECKERED) -->
          <div id="postFinishActions" class="post-finish hidden">
            <button id="btnResults" class="btn btn--results">
              Open results &amp; exports
            </button>
          </div>
          <div class="clockDisplay">
            <div class="clockMeta">
              <span class="toolbar-label">Mode</span>
              <button id="btnClockMode" class="btn btn-primary btn--sm" type="button"
                      title="Toggle elapsed/remaining">Remaining</button>
            </div>
            <div id="raceClock" class="bigClock">00:00:00</div>
          </div>
          <!--<div id="flagBanner" aria-live="polite">
            <span id="flagLabel">PRE</span>
            <span id="flagSublabel"></span>
          </div>-->
        </div>
      </section>

<!-- Right (row 2): Race data -->
<section class="pane" id="paneLive">
  <h2 class="pane__head" id="liveTitle">Race data</h2>
  <div class="pane__body rcLiveBody">

    <!-- PRE/COUNTDOWN: Seen list (table skin matches Standings) -->
    <div id="panelSeen">
      <div class="liveHead standingsHead">
        <div class="cell hdr title">Seen <span class="muted">(</span><span id="seenCount">0</span><span class="muted">/</span><span id="seenTotal">0</span><span class="muted">)</span></div>
      </div>

      <div class="seenScroll">
        <table id="rcSeen" class="rcTable">
          <thead>
            <tr>
              <th class="tag">TAG</th>
              <th class="num">Number</th>
              <th class="name">Name</th>
              <th class="reads">Reads</th>
            </tr>
          </thead>
          <tbody id="seenTbody"></tbody>
        </table>
      </div>
    </div>


    <!-- RACING/CHECKERED: Standings (scrolls inside only this pane) -->
  <div id="panelStandings" class="hidden">
      <!-- NEW: match the "Seen" header bar so both states consume equal height -->
      <div class="liveHead standingsHead">
        <div class="cell hdr title">Standings</div>
      </div>

      <div class="standingsScroll">
        <table id="rcStandings">
          <thead>
            <tr>
              <th class="pos">Pos</th>
              <th class="num">Number</th>
              <th class="name">Name</th>
              <th class="brake col-brake">Brake</th>
              <th class="laps">Laps</th>
              <th class="last">Last</th>
              <th class="pace">Pace</th>
              <th class="best">Best</th>
            </tr>
          </thead>
          <tbody><!-- rows injected by race_control.js --></tbody>
        </table>
      </div>
    </div>
</section>

    </div>
  </main>

  <!-- ==============================================================
       FOOTER — standardized
  ============================================================== -->
  <footer class="app-footer">
    <div class="footer-left">
  <div class="status-dot" id="netDot"></div>
      <div id="netMsg">Ready</div>
    </div>
    <div class="footer-center">
      <div class="pill pill--db" id="readyPill">DB: ready</div>
      <div class="pill pill--db" id="engineLabel">Engine: —</div>
    </div>
    <div class="footer-right"></div>
  </footer>

  <!-- JS -->
  <script src="../js/base.js" defer></script>
  <script src="../js/race_control.js" defer></script>

  <!-- Inline menu toggle -->
  <script>
    (function () {
      const menu  = document.getElementById('appsMenu');
      if (!menu) return;
      const btn   = menu.querySelector('.app-nav__btn');
      const panel = menu.querySelector('.app-nav__panel');
      function openMenu(on) { menu.dataset.open = on ? 'true' : 'false'; }
      btn.addEventListener('click', (e) => {
        e.stopPropagation();
        openMenu(menu.dataset.open !== 'true');
        if (menu.dataset.open === 'true') {
          const first = panel.querySelector('a'); if (first) first.focus();
        }
      });
      document.addEventListener('click', () => openMenu(false));
      document.addEventListener('keydown', (e) => { if (e.key === 'Escape') openMenu(false); });
      panel.addEventListener('keydown', (e) => {
        const items = Array.from(panel.querySelectorAll('a'));
        const i = items.indexOf(document.activeElement);
        if (e.key === 'ArrowDown') { e.preventDefault(); (items[i+1] || items[0]).focus(); }
        else if (e.key === 'ArrowUp') { e.preventDefault(); (items[i-1] || items[items.length-1]).focus(); }
        else if (e.key === 'Home')   { e.preventDefault(); (items[0] || document.activeElement).focus(); }
        else if (e.key === 'End')    { e.preventDefault(); (items[items.length-1] || document.activeElement).focus(); }
      });
    })();
  </script>
</body>
</html>
