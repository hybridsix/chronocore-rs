<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>CCRS — Settings</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- =====================================================================
       SETTINGS PAGE OVERVIEW
       ---------------------------------------------------------------------
       Purpose
       -------
       This page is the Operator-facing Settings screen. It uses the same
       header/footer chrome as the Entrants and Diagnostics pages and shows a
       left-hand navigation with anchor links into sections within the right
       scrollable pane. The layout is optimized for 1920×1080 with fixed
       header/footer heights defined in base/operator CSS.

       Behavior
       --------
       • Left-nav links are anchors (e.g., #ingest) that scroll the INTERNAL
         right-hand scroller (not the window). A scrollspy keeps the active
         highlight in sync with the section in view.
       • The actual input controls are progressively wired to the backend via
         /setup/runtime (GET) and apply endpoints (POST). Those hooks live in
         settings.js — this file focuses on structure and accessibility.

       Structure
       ---------
       Header  : CCRS wordmark + page label + engine pill (from base.js)
       Main    : .settingsWrap → .sideNav + .pane>.pane__scroll
       Footer  : Status on left; right side reserved for future shortcuts

       Dependencies
       -------------
       CSS  : base.css → operator.css → settings.css
       JS   : base.js (helpers/CCRS namespace) + settings.js (page logic)
  ===================================================================== -->

  <!-- Shared foundation stylesheets -->
  <link rel="stylesheet" href="../css/base.css" />
  <link rel="stylesheet" href="../css/operator.css" />

  <!-- Page-specific stylesheet for Settings (left-nav, grids, etc.) -->
  <link rel="stylesheet" href="../css/settings.css" />

  <!-- Base helper script for global CCRS utilities (defines CCRS.* helpers) -->
  <script src="../js/base.js" defer></script>

  <!-- Page logic: nav scrolling/scrollspy, runtime hydrate, apply/save -->
  <script src="../js/settings.js" defer></script>
</head>
<body class="page settings">
  <header class="app-header">
  <div class="brand">
    <!-- Brand: link back to Operator Home -->
    <a class="brand-link" href="/ui/operator/index.html" aria-label="Go to Home">
      <img
        class="brand-logo"
        src="../img/CCRS_Logo.svg"
        alt="ChronoCore Logo"
      />
      <div class="brand__wordmark" aria-label="ChronoCore Race Software">
        <div class="wordmark__top">
          <span class="wordmark__big">CHRONO</span>
          <span class="wordmark__big">CORE</span>
        </div>
        <div class="wordmark__bottom">RACE SOFTWARE</div>
      </div>
    </a>

  <!-- Page-specific label -->
  <div class="page-label">Settings</div>
  </div>

  <div class="app-header__tools">
    <!-- Right-side cluster: nav -->
    <nav class="app-nav" aria-label="Site navigation">
          <a class="app-nav__link" href="/ui/operator/index.html" aria-label="Home" title="Home">
            <svg class="icon" aria-hidden="true"><use href="../img/icons.svg#home"></use></svg>
            <span class="sr-only">Home</span>
          </a>

          <div class="app-nav__menu" id="appsMenu" data-open="false">
            <button type="button" class="app-nav__btn" aria-haspopup="true" aria-expanded="false"
                    aria-controls="appsPanel" title="Menu">
              <svg class="icon" aria-hidden="true"><use href="../img/icons.svg#menu"></use></svg>
              <span class="sr-only">Open menu</span>
            </button>
          <div class="app-nav__panel" id="appsPanel" role="menu" aria-labelledby="appsMenu">
        <a href="/ui/operator/entrants.html" role="menuitem">Entrants &amp; Tags</a>
        <a href="/ui/operator/operator.html" role="menuitem">Operator</a>
        <a class="current" href="/ui/operator/settings.html" role="menuitem">Settings</a>
        <a href="/ui/operator/diag.html" role="menuitem">Diagnostics</a>
        <a href="/ui/operator/help.html" role="menuitem">Help</a>
        </div>
      </div>
    </nav>
  </div>
</header>

  <!-- =====================================================================
       MAIN LAYOUT (two-column)
       ---------------------------------------------------------------------
       Left  : sticky side navigation (anchors)
       Right : scrollable pane (.pane__scroll) with one <section> per topic

       NOTE: Each <section> has an id that matches the left-nav href.
             The content inside each card can be grown as we wire backend.
  ===================================================================== -->
  <main class="settingsWrap">
    <!-- Side navigation: add/remove links as sections evolve. The separator
         visually isolates the final CTA (Apply/Save) from the others. -->
    <nav class="sideNav" aria-label="Settings sections">
      <a href="#client"      class="navLink">Client Role</a>
      <a href="#engine"      class="navLink">Engine Host</a>
      <a href="#ingest"      class="navLink">Ingest &amp; Debounce</a>
      <a href="#diagnostics" class="navLink">Diagnostics</a>
      <a href="#track"       class="navLink">Track Locations &amp; Bindings</a>
      <a href="#flags"       class="navLink">Flags</a>
      <a href="#missed"      class="navLink">Missed-Lap Detection</a>
      <a href="#ui"          class="navLink">UI &amp; Audio</a>

      <!-- Visual separator before the CTA link -->
      <div class="navSep" role="separator" aria-hidden="true"></div>

      <!-- Primary CTA: Apply / Save (same-page anchor) -->
      <a href="#apply" class="navLink navLink--primary">Apply / Save</a>
    </nav>

    <!-- Right content pane with its own scroll context. The scrollspy in
         settings.js observes these sections relative to this container. -->
    <div class="pane pane--right">
      <div class="pane__scroll">
        <!-- In a separate pass, these sections were filled with controls.
             Here we leave skeletal headings to keep this file focused on
             structure and documentation. settings.js performs hydration. -->

        <section id="client" class="card">
          <h2>Client Role</h2>
          <!-- Controls injected/managed by settings.js (role, saveRole, etc.) -->
        </section>

        <section id="engine" class="card">
          <h2>Engine Host</h2>
          <!-- effectiveHost / override fields live here (see settings.js). -->
        </section>

        <section id="ingest" class="card">
          <h2>Ingest &amp; Debounce</h2>
          <!-- Global debounce + per-location overrides + minLapMs. -->
        </section>

        <section id="diagnostics" class="card">
          <h2>Diagnostics</h2>
          <!-- Diagnostics enable, buffer size, transport, beep cap. -->
        </section>

        <section id="track" class="card">
          <h2>Track Locations &amp; Bindings</h2>
          <!-- Read-only lists for now; editor comes later. -->
        </section>

        <section id="flags" class="card">
          <h2>Flags</h2>
          <!-- Inference blocklist + post-green grace. -->
        </section>

        <section id="missed" class="card">
          <h2>Missed-Lap Detection</h2>
          <!-- Mode, window, sigma k, min gap, max inferred seq, mark flag. -->
        </section>

        <section id="ui" class="card">
          <h2>UI &amp; Audio</h2>
          <!-- Default sound + time display (local/UTC). -->
        </section>

        <section id="apply" class="card">
          <h2>Apply / Save</h2>
          <!-- Buttons + diff preview area handled by settings.js. -->
        </section>
      </div>
    </div>
  </main>

  <!-- =====================================================================
       FOOTER (fixed)
       ---------------------------------------------------------------------
       Left shows network status; right is intentionally empty for now.
       We can add quick links or version info later.
  ===================================================================== -->
  <footer class="app-footer">
    <div class="footer-left">
      <div class="status-dot" id="netDot"></div>
      <div id="netMsg">Ready</div>
    </div>
    <div class="footer-center">
      <div class="pill pill--db" id="readyPill" aria-live="polite">DB: ready</div>
      <div class="pill pill--db" id="engineLabel" aria-live="polite">Engine: —</div>
    </div>
    <div class="footer-right"></div>
  </footer>
</body>
</html>

<script>
  (function () {
    const menu = document.getElementById('appsMenu');
    if (!menu) return;
    const btn   = menu.querySelector('.app-nav__btn');
    const panel = menu.querySelector('.app-nav__panel');

    function openMenu(on) {
      menu.dataset.open = on ? 'true' : 'false';
      btn.setAttribute('aria-expanded', on ? 'true' : 'false');
    }

    btn.addEventListener('click', (e) => {
      e.stopPropagation();
      openMenu(menu.dataset.open !== 'true');
      if (menu.dataset.open === 'true') {
        const first = panel.querySelector('a');
        if (first) first.focus();
      }
    });

    document.addEventListener('click', () => openMenu(false));
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') openMenu(false);
    });

    panel.addEventListener('keydown', (e) => {
      const items = Array.from(panel.querySelectorAll('a'));
      const i = items.indexOf(document.activeElement);
      if (e.key === 'ArrowDown') {
        e.preventDefault();
        (items[i + 1] || items[0]).focus();
      } else if (e.key === 'ArrowUp') {
        e.preventDefault();
        (items[i - 1] || items[items.length - 1]).focus();
      } else if (e.key === 'Home') {
        e.preventDefault(); (items[0] || document.activeElement).focus();
      } else if (e.key === 'End') {
        e.preventDefault(); (items[items.length - 1] || document.activeElement).focus();
      }
    });
  })();
</script>