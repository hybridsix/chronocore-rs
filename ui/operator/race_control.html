<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>CCRS — Race Control</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- =====================================================================
       RACE CONTROL PAGE
       ---------------------------------------------------------------------
       Uses the same common header/footer as Diagnostics.
       CSS chain mirrors Diagnostics: base.css → operator.css → race_control.css
       JS  chain mirrors Diagnostics: base.js → race_control.js (page logic)
  ===================================================================== -->

  <!-- Common operator CSS -->
  <link rel="stylesheet" href="/ui/css/base.css" />
  <link rel="stylesheet" href="/ui/css/operator.css" />
  <!-- Page-specific CSS -->
  <link rel="stylesheet" href="/ui/css/race_control.css" />
</head>

<body class="race-control">
  <!-- ==============================================================
       HEADER — identical structure to Diagnostics / Live Sensors
  ============================================================== -->
  <header class="app-header">
    <div class="brand">
      <a class="brand-link" href="/ui/operator/index.html">
        <img class="brand-logo" src="../img/CCRS_Logo.svg" alt="CCRS Logo" />
        <div class="brand__wordmark">
          <div class="wordmark__top">
            <span class="wordmark__big">CHRONO</span>
            <span class="wordmark__big">CORE</span>
          </div>
          <div class="wordmark__bottom">RACE SOFTWARE</div>
        </div>
      </a>

      <div class="page-label">Race Control</div>
    </div>

    <!-- Right-side cluster: standard app nav -->
    <div class="app-header__tools">
      <nav class="app-nav">
        <a class="app-nav__link" href="/ui/operator/index.html" title="Home">
          <svg class="icon"><use href="../img/icons.svg#home"></use></svg>
          <span class="sr-only">Home</span>
        </a>

        <div class="app-nav__menu" id="appsMenu" data-open="false">
          <button type="button" class="app-nav__btn" title="Menu">
            <svg class="icon"><use href="../img/icons.svg#menu"></use></svg>
            <span class="sr-only">Open menu</span>
          </button>
          <div class="app-nav__panel" id="appsPanel">
            <a href="/ui/operator/entrants.html">Entrants &amp; Tags</a>
            <a href="/ui/operator/operator.html">Operator</a>
            <a href="/ui/operator/settings.html">Settings</a>
            <a href="/ui/operator/diag.html">Diagnostics</a>
            <a class="current" href="/ui/operator/race_control.html">Race Control</a>
            <a href="/ui/operator/help.html">Help</a>
          </div>
        </div>
      </nav>
    </div>
  </header>

  <!-- ==============================================================
       MAIN CONTENT
       --------------------------------------------------------------
       Top toolbar contains start method + pre-race + start/abort.
       Below is a two-pane layout: left = flag pad; right = live info.
  ============================================================== -->
  <main class="rcWrap">
    <!-- Top toolbar (shared visual with Diagnostics.toolBar) -->
    <div class="toolBar">
      <div class="left">
        <!-- Start type -->
        <label class="radio"><input type="radio" name="startMethod" id="startStanding" value="standing" checked><span>Standing</span></label>
        <label class="radio"><input type="radio" name="startMethod" id="startRolling" value="rolling"><span>Rolling</span></label>

        <!-- Pre-race group -->
        <div class="sep">|</div>
        <button id="btnStartParade" class="btn btn-primary">Parade</button>
        <button id="btnStartValidation" class="btn btn-primary">Validation</button>
        <button id="btnStopPrep" class="btn">Stop</button>
        <label class="chk"><input id="beepOnRead" type="checkbox" checked><span>Beep on read</span></label>

        <!-- Countdown / Start / Abort -->
        <div class="sep">|</div>
        <button id="btnCountdown10" class="btn">10s</button>
        <button id="btnGoGreen" class="btn btn-success">Go Green</button>
        <button id="btnAbort" class="btn btn-danger">Abort</button>
      </div>

      <div class="right">
        <!-- Active flag indicator chip -->
        <div class="banner" id="flagBanner">
          Active flag: <span class="flag-chip" id="flagChip" data-flag="off">OFF</span>
        </div>
      </div>
    </div>

    <!-- Two-pane layout (reuses .pane styling like Diagnostics) -->
    <div class="rcGrid">
      <!-- Left: Flags (exclusive) -->
        <div class="pane" id="paneFlags">
          <div class="pane__head">Flags</div>
          <div class="pane__body">
            <div id="flagColumn">
              <div class="flag-pad" id="flagPad">
                <button class="flag flag--green"     data-flag="green">Green</button>
                <button class="flag flag--yellow"    data-flag="yellow">Yellow</button>
                <button class="flag flag--white"     data-flag="white">White</button>
                <button class="flag flag--red hold"  data-flag="red" title="Hold to confirm">Red</button>
                <button class="flag flag--checkered hold" data-flag="checkered" title="Hold to confirm">Checkered</button>
                <button class="flag flag--blue"      data-flag="blue">Blue</button>
              </div>
            </div>
          </div>
        </div>


      <!-- Right: Timers + Seen list + Lap feed -->
      <div class="pane">
        <div class="pane__head">Live</div>
        <div class="pane__body rcLiveBody">
          <div class="timers">
            <div class="timer">
              <div class="timer__label">Elapsed</div>
              <div class="timer__value" id="tElapsed">00:00</div>
            </div>
            <div class="timer">
              <div class="timer__label">Remaining</div>
              <div class="timer__value" id="tRemaining">15:00</div>
            </div>
          </div>

          <div class="liveSplit">
            <div class="liveCol">
              <div class="liveHead">Seen (<span id="seenCount">0</span>/<span id="seenTotal">0</span>)</div>
              <ul id="seenList" class="liveList"></ul>
            </div>
            <div class="liveCol">
              <div class="liveHead">Last lap feed</div>
              <ul id="lapFeed" class="liveList"></ul>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- ==============================================================
       FOOTER — standard operator footer; keep consistent with pages
  ============================================================== -->
  <footer class="app-footer">
    <div class="footer-left">
      <div class="status-dot" id="netDot"></div>
      <div id="netMsg">Ready</div>
    </div>
    <div class="footer-center">
      <div class="pill pill--db" id="readyPill">DB: ready</div>
      <div class="pill pill--db" id="engineLabel">Engine: —</div>
    </div>
    <div class="footer-right"></div>
  </footer>

  <!-- Common base helpers, then page JS -->
  <script src="../js/base.js" defer></script>
  <script src="../js/race_control.js" defer></script>

  <!-- Inline menu toggle (same as Diagnostics) -->
  <script>
  (function () {
    const menu = document.getElementById('appsMenu');
    if (!menu) return;
    const btn   = menu.querySelector('.app-nav__btn');
    const panel = menu.querySelector('.app-nav__panel');
    function openMenu(on) { menu.dataset.open = on ? 'true' : 'false'; }
    btn.addEventListener('click', (e) => {
      e.stopPropagation();
      openMenu(menu.dataset.open !== 'true');
      if (menu.dataset.open === 'true') {
        const first = panel.querySelector('a'); if (first) first.focus();
      }
    });
    document.addEventListener('click', () => openMenu(false));
    document.addEventListener('keydown', (e) => { if (e.key === 'Escape') openMenu(false); });
    panel.addEventListener('keydown', (e) => {
      const items = Array.from(panel.querySelectorAll('a'));
      const i = items.indexOf(document.activeElement);
      if (e.key === 'ArrowDown') { e.preventDefault(); (items[i+1] || items[0]).focus(); }
      else if (e.key === 'ArrowUp') { e.preventDefault(); (items[i-1] || items[items.length-1]).focus(); }
      else if (e.key === 'Home') { e.preventDefault(); (items[0] || document.activeElement).focus(); }
      else if (e.key === 'End')  { e.preventDefault(); (items[items.length-1] || document.activeElement).focus(); }
    });
  })();
  </script>
</body>
</html>
