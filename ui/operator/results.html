<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Results - ChronoCore</title>

    <!-- Shared operator styles -->
    <link rel="stylesheet" href="../css/base.css" />
    <link rel="stylesheet" href="../css/operator.css" />

    <!-- Page-specific styles -->
    <link rel="stylesheet" href="../css/results.css" />

    <!-- Shared JS (net status, helpers you already use) -->
    <script src="../js/base.js" defer></script>

    <!-- Page JS -->
    <script src="../js/results.js" defer></script>
  </head>

  <body class="op-page results">
    <!-- ============================================================= -->
    <!-- Header (canonical operator header)                           -->
    <!-- ============================================================= -->
    <header class="app-header">
      <div class="brand">
        <a class="brand-link" href="/ui/operator/index.html">
          <img class="brand-logo" src="../img/CCRS_Logo.svg" alt="ChronoCore Logo" />
          <div class="brand__wordmark" aria-label="ChronoCore Race Software">
            <div class="wordmark__top">
              <span class="wordmark__big">CHRONO</span>
              <span class="wordmark__big">CORE</span>
            </div>
            <div class="wordmark__bottom">RACE SOFTWARE</div>
          </div>
        </a>
        <div class="page-label">Results</div>
      </div>

      <div class="app-header__tools">
        <nav class="app-nav">
          <a class="app-nav__link" href="/ui/operator/index.html" title="Home">
            <svg class="icon"><use href="../img/icons.svg#home"></use></svg>
            <span class="sr-only">Home</span>
          </a>

          <div class="app-nav__menu" id="appsMenu" data-open="false">
            <button type="button" class="app-nav__btn" title="Menu">
              <svg class="icon"><use href="../img/icons.svg#menu"></use></svg>
              <span class="sr-only">Open menu</span>
            </button>
            <div class="app-nav__panel" id="appsPanel">
              <a href="/ui/operator/race_setup.html">Race Setup</a>
              <a href="/ui/operator/race_control.html">Race Control</a>
              <a href="/ui/operator/entrants.html">Entrants &amp; Tags</a>
              <a href="/ui/operator/results.html">Results</a>
              <a href="/ui/operator/diag.html">Diagnostics</a>
              <a href="/ui/operator/moxie_board.html">Moxie Board</a>
              <a href="/ui/operator/settings.html">Settings</a>
              <a href="/ui/operator/about.html">About</a>
            </div>
          </div>
        </nav>
      </div>
    </header>

    <!-- ============================================================= -->
    <!-- Main: fixed-canvas layout (no outer scrollbar)                -->
    <!-- ============================================================= -->
    <main class="wrap">
      <section class="results-layout">
        <!-- --------------------------------------------------------- -->
        <!-- Left rail: heats list + admin controls                    -->
        <!-- --------------------------------------------------------- -->
        <aside class="rail">
          <div class="rail__head">
            <h2 class="rail__title">Heats</h2>
            <button id="btnRefreshHeats" class="btn btn-small" title="Refresh heats list">Refresh</button>
          </div>

          <div id="heatList" class="rail__list"><!-- populated by JS --></div>
          <div class="rail__empty" id="railEmpty" hidden>No heats found.</div>

          <!-- Admin actions pinned in the rail (Delete, Copy, Purge) -->
          <div id="railAdmin" class="rail-admin">
            <div class="rail-admin__group">
              <button id="btnCopyLinks"  type="button" class="btn btn--secondary">Copy Links</button>
              <button id="btnDeleteHeat" type="button" class="btn btn--danger">Delete Heat</button>
              <button id="btnPurgeAll"   type="button" class="btn btn--danger-outline">Delete ALL</button>
            </div>
            <small class="rail-admin__hint">Actions affect frozen results only â€” not live race data.</small>
          </div>
        </aside>

        <!-- --------------------------------------------------------- -->
        <!-- Right / main pane                                         -->
        <!-- --------------------------------------------------------- -->
        <section class="pane">
          <!-- Top bar: identity (no mode chips here anymore) -->
          <div class="topbar">
            <div class="topbar__left">
              <div class="heat-title" id="heatTitle">-</div>
              <div class="heat-window" id="heatWindow">-</div>
            </div>

            <div class="topbar__right">
              <div class="stats">
                <div class="stat">
                  <div class="stat__label">Fast Lap</div>
                  <div class="stat__value" id="statFast">-</div>
                </div>
                <div class="stat">
                  <div class="stat__label">Classified</div>
                  <div class="stat__value" id="statCars">-</div>
                </div>
              </div>
            </div>
          </div>

          <!-- View controls: SINGLE source toggle (Frozen vs Live Preview) -->
          <!-- Replaces previous chips + Freeze controls entirely.         -->
          <div class="results-controls">
            <div class="pillbar" role="tablist" aria-label="Results view mode">
              <button id="pillFrozen" class="pill is-on" role="tab" aria-selected="true">Frozen</button>
              <button id="pillLive"   class="pill" role="tab" aria-selected="false" title="Preview live engine state">Live Preview</button>
            </div>

            <!-- Hidden for now; will show when penalties/DQ logic ships -->
            <div id="penaltyBar" class="penaltybar" hidden>
              <button id="btnDemote" class="btn btn--tiny btn--danger" type="button" title="Move the selected entrant down one position">Demote</button>
            </div>

            <div id="viewHint" class="view-hint" aria-live="polite"></div>
          </div>

          <!-- Tabs -->
          <div class="tabs" id="tabs">
            <button class="tab is-active" data-tab="standings">Standings</button>
            <button class="tab" data-tab="laps">Lap Table</button>
          </div>

          <!-- Tab: Standings -->
          <div class="panel" id="panel-standings">
            <div class="table-wrap">
              <table id="tblStandings" class="table">
                <thead>
                  <tr>
                    <th>Pos</th>
                    <th>#</th>
                    <th>Name</th>
                    <th>Laps</th>
                    <th>Def</th>
                    <th>Last</th>
                    <th>Best</th>
                    <th>Grid</th>
                    <th>Brake</th>
                    <th>Pits</th>
                  </tr>
                </thead>
                <tbody id="tbodyStandings"><!-- rows via JS --></tbody>
              </table>
              <div class="empty" id="standingsEmpty" hidden>No standings yet.</div>
            </div>
          </div>

          <!-- Tab: Laps table -->
          <div class="panel is-hidden" id="panel-laps">
            <div class="table-wrap">
              <table id="tblLaps" class="table table--mono">
                <thead>
                  <tr>
                    <th>#</th>
                    <th>Name</th>
                    <th>Lap</th>
                    <th>Lap ms</th>
                    <th>Lap</th>
                    <th>Cumul ms</th>
                    <th>Cumul</th>
                    <th>ts_ms</th>
                    <th>UTC</th>
                    <th>Flag</th>
                    <th>Src</th>
                    <th>Loc ID</th>
                    <th>Loc</th>
                    <th>Inf</th>
                  </tr>
                </thead>
                <tbody id="tbodyLaps"><!-- rows via JS (chunked render) --></tbody>
              </table>
              <div class="empty" id="lapsEmpty" hidden>No laps recorded.</div>
            </div>
          </div>

          <!-- Exports -->
          <div class="exports">
            <button class="btn" id="btnStandingsCSV">Standings CSV</button>
            <button class="btn" id="btnStandingsJSON">Standings JSON</button>
            <button class="btn" id="btnLapsCSV">Laps CSV</button>
            <button class="btn" id="btnLapsJSON">Laps JSON</button>
            <button class="btn" id="btnPassesCSV" disabled>Passes CSV</button>
            <button class="btn btn--archive" id="btnExportAll">Export All Heats</button>
          </div>
        </section>
      </section>
    </main>

    <!-- ============================================================= -->
    <!-- Footer                                                        -->
    <!-- ============================================================= -->
    <footer class="app-footer">
      <div class="footer-left">
        <span id="netDot" class="status-dot"></span>
        <span id="netMsg" class="pill pill--db">DB: Offline</span>
      </div>
      <div class="footer-center"></div>
      <div class="footer-right">
        <span class="muted">ChronoCoreRS</span>
      </div>
    </footer>

    <!-- Small, self-contained menu toggler -->
    <script>
      (function () {
        const menu = document.getElementById('appsMenu');
        if (!menu) return;
        const btn = menu.querySelector('.app-nav__btn');
        const panel = menu.querySelector('.app-nav__panel');
        function openMenu(on) { menu.dataset.open = on ? 'true' : 'false'; }
        btn.addEventListener('click', (e) => {
          e.stopPropagation();
          openMenu(menu.dataset.open !== 'true');
          if (menu.dataset.open === 'true') {
            const first = panel.querySelector('a');
            if (first) first.focus();
          }
        });
        document.addEventListener('click', () => openMenu(false));
        document.addEventListener('keydown', (ev) => { if (ev.key === 'Escape') openMenu(false); });
      })();
    </script>
  </body>
</html>
